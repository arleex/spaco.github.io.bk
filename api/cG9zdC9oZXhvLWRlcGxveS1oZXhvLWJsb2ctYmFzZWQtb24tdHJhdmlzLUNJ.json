{"title":"Deploy Hexo blog based on travis-CI","date":"2018-09-01T00:00:00.000Z","slug":"hexo-deploy-hexo-blog-based-on-travis-CI","tags":["Hexo"],"categories":["notes"],"updated":"2019-04-23T10:15:52.183Z","content":"<h2 id=\"Quick-Start\">Quick Start<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#Quick-Start\"></a></h2><h3 id=\"travis-ci-是什么\">travis-ci 是什么<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#travis-ci-是什么\"></a></h3><p>一个使用yaml格式配置用于持续集成完成自动化测试部署的开源项目<br>官网：<a href=\"https://travis-ci.com/\" target=\"_blank\" rel=\"noopener\">https://travis-ci.com/</a></p>\n<h3 id=\"为什么使用-travis-ci-部署-Hexo-blog\">为什么使用 travis-ci 部署 Hexo blog<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#为什么使用-travis-ci-部署-Hexo-blog\"></a></h3><ul>\n<li>避免换电脑需要安装环境</li>\n<li>可以随时更改 blog 内容</li>\n<li>不喜欢每次 hexo g  + hexo d</li>\n</ul>\n<h3 id=\"原理\">原理<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#原理\"></a></h3><p>github 设置两个分支，master develop,</p>\n<p>travis-ci 检测 develop 的改动，编译之后将需要的数据提交到 master</p>\n<h3 id=\"涉及的主要内容\">涉及的主要内容<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#涉及的主要内容\"></a></h3><ul>\n<li><p>GitHub-Pages</p>\n</li>\n<li><p>Travis-CI 账号</p>\n</li>\n<li><p><a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener\">github token</a></p>\n<p>coding 同样</p>\n</li>\n</ul>\n<h3 id=\"Create-GitHub-token\">Create GitHub token<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#Create-GitHub-token\"></a></h3><ol>\n<li><p>进入 <a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener\">github token</a>，点击 Generate new token</p>\n</li>\n<li><p>完善 Token description ，Select scopes</p>\n</li>\n<li><p>save</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3625649-e8ace54949737ec2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h3 id=\"同步github-repository\">同步github repository<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#同步github-repository\"></a></h3><div class=\"article-img\"><p><img src=\"https://upload-images.jianshu.io/upload_images/3625649-27986c1344ef0e31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/740\" alt=\"image.png\" data-zoomable=\"\"></p></div>\n<ol>\n<li><p>登陆 travis-ci</p>\n</li>\n<li><p><a href=\"https://travis-ci.com/account/repositories\" target=\"_blank\" rel=\"noopener\">https://travis-ci.com/account/repositories</a></p>\n</li>\n<li><p>同步 repository</p>\n<p>点击 <code>manage repositories on Github</code></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3625649-be37009a1c05a232.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/540\" alt=\"image.png\"></p>\n</li>\n<li><p>点击已同步 repository 右边的 setting</p>\n</li>\n<li><p>配置 Environment Variables ：会在部署脚本中使用到</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3625649-acfd05be85246188.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640\" alt=\"image.png\"></p>\n<p>GH_REF : github.com/spaco/spaco.github.io.git</p>\n<p>GH_TOKEN : 上个步骤获得的 github token</p>\n</li>\n</ol>\n<h3 id=\"Github-repository-setting\">Github  repository setting<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#Github-repository-setting\"></a></h3><p><code>以github一个空仓库为示范,但是已实现本地 blog 预览</code></p>\n<ol>\n<li>create develop branch</li>\n<li>set default branch = develop</li>\n</ol>\n<h3 id=\"Run-travis-ci\">Run travis-ci<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#Run-travis-ci\"></a></h3><p>运行 travis-ci，需要配置 .travis.yml ,默认检测此文件，详情见下方 Extra</p>\n<p>将 develop 编译之后的内容 提交到 master，现有如下几种方式</p>\n<ul>\n<li>copy ssh key</li>\n<li>github token : master 永远只有一次 commit log</li>\n<li>github token : master commit log 保存 （推荐）</li>\n</ul>\n<p>git push to develop , travis-ci run</p>\n<div class=\"article-img\"><p><img src=\"https://upload-images.jianshu.io/upload_images/3625649-a020d050be405391.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/740\" alt=\"image.png\" data-zoomable=\"\"></p></div>\n<h3 id=\"QAQ\">QAQ<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#QAQ\"></a></h3><ul>\n<li><p>Q : 通过git clone theme,但是通过 travis-ci 自动部署的时候，无法提交 theme文件，因为theme所属另外一个 GitHub-repository</p>\n<p>A : 使用 git submodule clone theme </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[submodule <span class=\"string\">\"themes/inside\"</span>]</span><br><span class=\"line\">\tpath = themes/inside</span><br><span class=\"line\">\turl = https://github.com/spaco/hexo-theme-inside.git</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"Extra\">Extra<a href=\"post/hexo-deploy-hexo-blog-based-on-travis-CI#Extra\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">language: node_js</span><br><span class=\"line\">node_js: stable</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># S: Build Lifecycle</span></span><br><span class=\"line\">install:</span><br><span class=\"line\">- npm install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#before_script:</span></span><br><span class=\"line\"><span class=\"comment\"># - npm install -g gulp</span></span><br><span class=\"line\"></span><br><span class=\"line\">script:</span><br><span class=\"line\">  - hexo g</span><br><span class=\"line\"></span><br><span class=\"line\">after_script:</span><br><span class=\"line\">  - git <span class=\"built_in\">clone</span> https://<span class=\"variable\">$&#123;GH_REF&#125;</span> .deploy_git  <span class=\"comment\"># GH_REF是最下面配置的仓库地址</span></span><br><span class=\"line\">  - <span class=\"built_in\">cd</span> .deploy_git</span><br><span class=\"line\">  - git checkout master</span><br><span class=\"line\">  - <span class=\"built_in\">cd</span> ../</span><br><span class=\"line\">  - mv .deploy_git/.git/ ./public/   <span class=\"comment\"># 这一步之前的操作是为了保留master分支的提交记录，不然每次git init的话只有1条commit</span></span><br><span class=\"line\">  - <span class=\"built_in\">cd</span> ./public</span><br><span class=\"line\">  - git config user.name <span class=\"string\">\"spaco\"</span></span><br><span class=\"line\">  - git config user.email <span class=\"string\">\"she.ct@outlook.com\"</span></span><br><span class=\"line\">  - git add .</span><br><span class=\"line\">  - git commit -m <span class=\"string\">\"Travis automatically updates the document\"</span></span><br><span class=\"line\">  - git push --force --quiet <span class=\"string\">\"https://<span class=\"variable\">$&#123;GH_TOKEN&#125;</span>@<span class=\"variable\">$&#123;GH_REF&#125;</span>\"</span> master:master</span><br><span class=\"line\"><span class=\"comment\"># E: Build LifeCycle</span></span><br><span class=\"line\"></span><br><span class=\"line\">branches:</span><br><span class=\"line\">  only:</span><br><span class=\"line\">    - develop</span><br></pre></td></tr></table></figure>\n","prev":{"title":"Build a Hexo blog based on github-pages","slug":"hexo-blog-based-on-github-pages"},"next":{"title":"Principle if queue","slug":"principle-of-queue"},"link":"https://spaco.github.io/post/hexo-deploy-hexo-blog-based-on-travis-CI/","toc":[{"title":"Quick Start","id":"Quick-Start","index":"1","children":[{"title":"travis-ci 是什么","id":"travis-ci-是什么","index":"1.1"},{"title":"为什么使用 travis-ci 部署 Hexo blog","id":"为什么使用-travis-ci-部署-Hexo-blog","index":"1.2"},{"title":"原理","id":"原理","index":"1.3"},{"title":"涉及的主要内容","id":"涉及的主要内容","index":"1.4"},{"title":"Create GitHub token","id":"Create-GitHub-token","index":"1.5"},{"title":"同步github repository","id":"同步github-repository","index":"1.6"},{"title":"Github  repository setting","id":"Github-repository-setting","index":"1.7"},{"title":"Run travis-ci","id":"Run-travis-ci","index":"1.8"},{"title":"QAQ","id":"QAQ","index":"1.9"},{"title":"Extra","id":"Extra","index":"1.10"}]}]}