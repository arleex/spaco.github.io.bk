{"title":"Test f","date":"2018-12-14T00:00:00.000Z","slug":"test/test","tags":["elasticsearch"],"categories":["program"],"updated":"2019-02-20T07:38:22.014Z","content":"<h2 id=\"Elasticsearch\"><a href=\"#Elasticsearch\" class=\"headerlink\" title=\"Elasticsearch\"></a>Elasticsearch</h2><h3 id=\"Foreword\"><a href=\"#Foreword\" class=\"headerlink\" title=\"Foreword\"></a>Foreword</h3><h3 id=\"Why-ES\"><a href=\"#Why-ES\" class=\"headerlink\" title=\"Why ES\"></a>Why ES</h3><ul>\n<li>成熟</li>\n<li>高可用</li>\n<li>高扩展</li>\n</ul>\n<h3 id=\"Development-Environment\"><a href=\"#Development-Environment\" class=\"headerlink\" title=\"Development Environment\"></a>Development Environment</h3><ul>\n<li><p>elasticsearch</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## version</span></span><br><span class=\"line\">6.6.0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>kibana</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## version</span></span><br><span class=\"line\">6.6.0</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"Point-Conception\"><a href=\"#Point-Conception\" class=\"headerlink\" title=\"Point Conception\"></a>Point Conception</h3><ul>\n<li><p><a href=\"https://lucene.apache.org/\" target=\"_blank\" rel=\"noopener\">Apache Lucene</a></p>\n<p>Lucene是一套用于全文检索和搜寻的开放源码程式库，由Apache软件基金会支持和提供。Lucene提供了一个简单却强大的应用程序界面，能够做全文索引和搜寻，在Java开发环境里Lucene是一个成熟的免费开放源代码工具；就其本身而论，Lucene是现在并且是这几年，最受欢迎的免费Java资讯检索程式库。</p>\n</li>\n<li><p>Inverted Index</p>\n<p>Lucene实现快速搜索的核心就是倒排索引</p>\n</li>\n<li><p><a href=\"https://baike.baidu.com/item/全文搜索引擎\" target=\"_blank\" rel=\"noopener\">全文搜索引擎</a></p>\n<p>全文<a href=\"https://baike.baidu.com/item/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/104812\" target=\"_blank\" rel=\"noopener\">搜索引擎</a>是目前广泛应用的搜索引擎。它的工作原理是计算机<a href=\"https://baike.baidu.com/item/%E7%B4%A2%E5%BC%95\" target=\"_blank\" rel=\"noopener\">索引</a>程序通过扫描文章中的每一个词，对每一个词建立一个<a href=\"https://baike.baidu.com/item/%E7%B4%A2%E5%BC%95/5716853\" target=\"_blank\" rel=\"noopener\">索引</a>，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。</p>\n</li>\n<li><p>Java</p>\n<p>Elasticsearch是使用 Java 开发的</p>\n</li>\n<li><p><a href=\"https://lucene.apache.org/solr/\" target=\"_blank\" rel=\"noopener\">Solr</a></p>\n<p>Solr是用<a href=\"https://zh.wikipedia.org/wiki/Java\" target=\"_blank\" rel=\"noopener\">Java</a>编写、运行在<a href=\"https://zh.wikipedia.org/wiki/Servlet\" target=\"_blank\" rel=\"noopener\">Servlet</a>容器（如<a href=\"https://zh.wikipedia.org/wiki/Apache_Tomcat\" target=\"_blank\" rel=\"noopener\">Apache Tomcat</a>或<a href=\"https://zh.wikipedia.org/wiki/Jetty\" target=\"_blank\" rel=\"noopener\">Jetty</a>）的一个独立的全文搜索服务器。 Solr采用了<a href=\"https://zh.wikipedia.org/wiki/Lucene\" target=\"_blank\" rel=\"noopener\">Lucene</a> Java搜索库为核心的全文索引和搜索，并具有类似<a href=\"https://zh.wikipedia.org/wiki/REST\" target=\"_blank\" rel=\"noopener\">REST</a>的<a href=\"https://zh.wikipedia.org/wiki/HTTP\" target=\"_blank\" rel=\"noopener\">HTTP</a>/<a href=\"https://zh.wikipedia.org/wiki/XML\" target=\"_blank\" rel=\"noopener\">XML</a>和<a href=\"https://zh.wikipedia.org/wiki/JSON\" target=\"_blank\" rel=\"noopener\">JSON</a>的<a href=\"https://zh.wikipedia.org/wiki/API\" target=\"_blank\" rel=\"noopener\">API</a>。 Solr强大的外部配置功能使得无需进行Java编码，便可对其进行调整以适应多种类型的应用程序。Solr有一个插件架构，以支持更多的高级定制。</p>\n</li>\n<li><p>Near Realtime (NRT)</p>\n<p>Elasticsearch是一个近乎实时的搜索平台。这意味着从索引文档到可以搜索的时间只有轻微的延迟（通常是1秒</p>\n</li>\n<li><p>Cluster</p>\n<p>集群是一个或多个节点(服务器)的集合，它们共同保存你的整个数据，并提供跨所有节点的联合索引和搜索功能。一个集群由一个唯一的名称标识，默认这个唯一标识的名称是”elasticsearch”。这个名称很重要，因为如果节点被设置为按其名称加入集群，那么节点只能是集群的一部分。</p>\n<p>确保不要在不同的环境中用相同的集群名称，否则可能导致节点加入到错误的集群中。例如，你可以使用”logging-dev”, “logging-test”, “logging-prod”分别用于开发、测试和正式集群的名字。</p>\n</li>\n<li><p>Node</p>\n<p>节点是一个单独的服务器，它是集群的一部分，存储数据，并参与集群的索引和搜索功能。就像集群一样，节点由一个名称来标识，默认情况下，该名称是在启动时分配给节点的随机通用唯一标识符(UUID)。如果不想用默认的节点名，可以定义任何想要的节点名。这个名称对于管理来说很重要，因为你希望识别网络中的哪些服务器对应于你的Elasticsearch集群中的哪些节点。</p>\n<p>一个节点可以通过配置集群名称来加入到一个特定的集群中。默认情况下，每个节点都被设置加入到一个名字叫”elasticsearch”的集群中，这就意味着如果你启动了很多个节点，并且假设它们彼此可以互相发现，那么它们将自动形成并加入到一个名为”elasticsearch”的集群中。</p>\n<p>一个集群可以有任意数量的节点。此外，如果在你的网络上当前没有运行任何节点，那么此时启动一个节点将默认形成一个单节点的名字叫”elasticsearch”的集群。</p>\n</li>\n<li><p>Index</p>\n<p>索引是具有某种相似特征的文档的集合。例如，你可以有一个顾客数据索引，产品目录索引和订单数据索引。索引有一个名称标识，该名称用于在对其中的文档执行索引、搜索、更新和删除操作时引用索引。</p>\n</li>\n<li><p>Document</p>\n<p>文档是可以被索引的基本信息单元，类似数据库的单条表数据</p>\n</li>\n</ul>\n<h3 id=\"Install\"><a href=\"#Install\" class=\"headerlink\" title=\"Install\"></a>Install</h3><ul>\n<li><p>Docker</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Elasticsearch Dockerfile</span></span><br><span class=\"line\"></span><br><span class=\"line\">FROM docker.elastic.co/elasticsearch/elasticsearch:6.6.0</span><br><span class=\"line\"></span><br><span class=\"line\">EXPOSE 9200 9300</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Kibana Dockerfile</span></span><br><span class=\"line\"></span><br><span class=\"line\">FROM docker.elastic.co/kibana/kibana:6.6.0</span><br><span class=\"line\"></span><br><span class=\"line\">EXPOSE 5601</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-install.html\" target=\"_blank\" rel=\"noopener\">Others</a></p>\n</li>\n</ul>\n<h3 id=\"Build-amp-Start\"><a href=\"#Build-amp-Start\" class=\"headerlink\" title=\"Build &amp; Start\"></a>Build &amp; Start</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d elasticsearch kibana</span><br></pre></td></tr></table></figure>\n<h3 id=\"Check\"><a href=\"#Check\" class=\"headerlink\" title=\"Check\"></a>Check</h3><ul>\n<li><p>Elasticsearch</p>\n<p>Open <code>localhost:9200</code> with your browser</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"aJRPWzC\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"cluster_name\"</span>: <span class=\"string\">\"laradock-cluster\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"cluster_uuid\"</span>: <span class=\"string\">\"Bd8hjDXlTNSS5yQIondlDg\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"version\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"number\"</span>: <span class=\"string\">\"6.6.0\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"build_flavor\"</span>: <span class=\"string\">\"default\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"build_type\"</span>: <span class=\"string\">\"tar\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"build_hash\"</span>: <span class=\"string\">\"a9861f4\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"build_date\"</span>: <span class=\"string\">\"2019-01-24T11:27:09.439740Z\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"build_snapshot\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"string\">\"lucene_version\"</span>: <span class=\"string\">\"7.6.0\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"minimum_wire_compatibility_version\"</span>: <span class=\"string\">\"5.6.0\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"minimum_index_compatibility_version\"</span>: <span class=\"string\">\"5.0.0\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"tagline\"</span>: <span class=\"string\">\"You Know, for Search\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Kibana</p>\n<p>Open <code>localhost:5601</code> with your browser</p>\n</li>\n</ul>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><h4 id=\"Index\"><a href=\"#Index\" class=\"headerlink\" title=\"Index\"></a>Index</h4><ul>\n<li><p>Create Index</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT index_name</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## PUT twitter</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"acknowledged\"</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">\"shards_acknowledged\"</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">\"index\"</span> : <span class=\"string\">\"twitter\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Index List</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X GET <span class=\"string\">\"localhost:9200/_cat/indices?v\"</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"Document\"><a href=\"#Document\" class=\"headerlink\" title=\"Document\"></a>Document</h4><ul>\n<li><p>Create Document</p>\n<p><code>PUT index_name/_doc</code></p>\n<p>指定id</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 指定id</span></span><br><span class=\"line\">PUT twitter/_doc/1</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"user\"</span> : <span class=\"string\">\"kimchy\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"post_date\"</span> : <span class=\"string\">\"2009-11-15T14:12:12\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"message\"</span> : <span class=\"string\">\"trying out Elasticsearch\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Result:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"_index\"</span> : <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_type\"</span> : <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_id\"</span> : <span class=\"string\">\"1\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_version\"</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">\"result\"</span> : <span class=\"string\">\"created\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_shards\"</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">\"total\"</span> : 2,</span><br><span class=\"line\">    <span class=\"string\">\"successful\"</span> : 1,</span><br><span class=\"line\">    <span class=\"string\">\"failed\"</span> : 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"_seq_no\"</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">\"_primary_term\"</span> : 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>不指定id</p>\n<p><code>POST index_name/_doc</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST twitter/_doc/</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"user\"</span> : <span class=\"string\">\"kimchy\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"post_date\"</span> : <span class=\"string\">\"2009-11-15T14:12:12\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"message\"</span> : <span class=\"string\">\"trying out Elasticsearch\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"_index\"</span> : <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_type\"</span> : <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_id\"</span> : <span class=\"string\">\"TGap7GgBR1R5Vn49jL0L\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_version\"</span> : 1,</span><br><span class=\"line\">  <span class=\"string\">\"result\"</span> : <span class=\"string\">\"created\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_shards\"</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">\"total\"</span> : 2,</span><br><span class=\"line\">    <span class=\"string\">\"successful\"</span> : 1,</span><br><span class=\"line\">    <span class=\"string\">\"failed\"</span> : 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"_seq_no\"</span> : 0,</span><br><span class=\"line\">  <span class=\"string\">\"_primary_term\"</span> : 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Update Document</p>\n<p><code>PUT index_name/_doc/primark_key</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT twitter/_doc/1</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"user\"</span>:<span class=\"string\">\"new-kimchy\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Result:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"_index\"</span>: <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_type\"</span>: <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_id\"</span>: <span class=\"string\">\"1\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_version\"</span>: 2,</span><br><span class=\"line\">    <span class=\"string\">\"result\"</span>: <span class=\"string\">\"updated\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_shards\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"total\"</span>: 2,</span><br><span class=\"line\">        <span class=\"string\">\"successful\"</span>: 1,</span><br><span class=\"line\">        <span class=\"string\">\"failed\"</span>: 0</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"_seq_no\"</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">\"_primary_term\"</span>: 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Delete Document</p>\n<p><code>DELETE index_name/_doc/primark_key</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DELETE /twitter/_doc/2</span><br></pre></td></tr></table></figure>\n<p>Result:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"_index\"</span>: <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_type\"</span>: <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_id\"</span>: <span class=\"string\">\"2\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_version\"</span>: 3,</span><br><span class=\"line\">    <span class=\"string\">\"result\"</span>: <span class=\"string\">\"deleted\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_shards\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"total\"</span>: 2,</span><br><span class=\"line\">        <span class=\"string\">\"successful\"</span>: 1,</span><br><span class=\"line\">        <span class=\"string\">\"failed\"</span>: 0</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"_seq_no\"</span>: 4,</span><br><span class=\"line\">    <span class=\"string\">\"_primary_term\"</span>: 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Search Document</p>\n<ul>\n<li><p>Easy Search</p>\n<p><code>GET /index_name/_search?q=key:value</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /twitter/_search?q=user:kimchy</span><br></pre></td></tr></table></figure>\n<p>Result</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"took\"</span>: 35,</span><br><span class=\"line\">    <span class=\"string\">\"timed_out\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_shards\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"total\"</span>: 5,</span><br><span class=\"line\">        <span class=\"string\">\"successful\"</span>: 5,</span><br><span class=\"line\">        <span class=\"string\">\"skipped\"</span>: 0,</span><br><span class=\"line\">        <span class=\"string\">\"failed\"</span>: 0</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"hits\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"total\"</span>: 3,</span><br><span class=\"line\">        <span class=\"string\">\"max_score\"</span>: 0.2876821,</span><br><span class=\"line\">        <span class=\"string\">\"hits\"</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">\"_index\"</span>: <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_type\"</span>: <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_id\"</span>: <span class=\"string\">\"TGap7GgBR1R5Vn49jL0L\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_score\"</span>: 0.2876821,</span><br><span class=\"line\">                <span class=\"string\">\"_source\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"user\"</span>: <span class=\"string\">\"kimchy\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"post_date\"</span>: <span class=\"string\">\"2009-11-15T14:12:12\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"message\"</span>: <span class=\"string\">\"trying out Elasticsearch\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">\"_index\"</span>: <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_type\"</span>: <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_id\"</span>: <span class=\"string\">\"1\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_score\"</span>: 0.2876821,</span><br><span class=\"line\">                <span class=\"string\">\"_source\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"user\"</span>: <span class=\"string\">\"new-kimchy\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">\"_index\"</span>: <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_type\"</span>: <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_id\"</span>: <span class=\"string\">\"3\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"_score\"</span>: 0.2876821,</span><br><span class=\"line\">                <span class=\"string\">\"_source\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"user\"</span>: <span class=\"string\">\"kimchy\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"post_date\"</span>: <span class=\"string\">\"2009-11-15T14:12:12\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"messages\"</span>: <span class=\"string\">\"trying out Elasticsearch\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Request Body Search</p>\n<p>ES 提供了一种JSON风格的 Query DSL (domain specific language)</p>\n<p>使用request body 传递参数，更加灵活</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /twitter/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"query\"</span> : &#123;</span><br><span class=\"line\">        <span class=\"string\">\"term\"</span> : &#123; <span class=\"string\">\"user\"</span> : <span class=\"string\">\"kimchy\"</span> &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Result</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"took\"</span> : 3,</span><br><span class=\"line\">  <span class=\"string\">\"timed_out\"</span> : <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"string\">\"_shards\"</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">\"total\"</span> : 5,</span><br><span class=\"line\">    <span class=\"string\">\"successful\"</span> : 5,</span><br><span class=\"line\">    <span class=\"string\">\"skipped\"</span> : 0,</span><br><span class=\"line\">    <span class=\"string\">\"failed\"</span> : 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"hits\"</span> : &#123;</span><br><span class=\"line\">    <span class=\"string\">\"total\"</span> : 3,</span><br><span class=\"line\">    <span class=\"string\">\"max_score\"</span> : 0.2876821,</span><br><span class=\"line\">    <span class=\"string\">\"hits\"</span> : [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"string\">\"_index\"</span> : <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_type\"</span> : <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_id\"</span> : <span class=\"string\">\"TGap7GgBR1R5Vn49jL0L\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_score\"</span> : 0.2876821,</span><br><span class=\"line\">        <span class=\"string\">\"_source\"</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">\"user\"</span> : <span class=\"string\">\"kimchy\"</span>,</span><br><span class=\"line\">          <span class=\"string\">\"post_date\"</span> : <span class=\"string\">\"2009-11-15T14:12:12\"</span>,</span><br><span class=\"line\">          <span class=\"string\">\"message\"</span> : <span class=\"string\">\"trying out Elasticsearch\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"string\">\"_index\"</span> : <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_type\"</span> : <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_id\"</span> : <span class=\"string\">\"1\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_score\"</span> : 0.2876821,</span><br><span class=\"line\">        <span class=\"string\">\"_source\"</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">\"user\"</span> : <span class=\"string\">\"new-kimchy\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"string\">\"_index\"</span> : <span class=\"string\">\"twitter\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_type\"</span> : <span class=\"string\">\"_doc\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_id\"</span> : <span class=\"string\">\"3\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"_score\"</span> : 0.2876821,</span><br><span class=\"line\">        <span class=\"string\">\"_source\"</span> : &#123;</span><br><span class=\"line\">          <span class=\"string\">\"user\"</span> : <span class=\"string\">\"kimchy\"</span>,</span><br><span class=\"line\">          <span class=\"string\">\"post_date\"</span> : <span class=\"string\">\"2009-11-15T14:12:12\"</span>,</span><br><span class=\"line\">          <span class=\"string\">\"messages\"</span> : <span class=\"string\">\"trying out Elasticsearch\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Test\"><a href=\"#Test\" class=\"headerlink\" title=\"Test\"></a>Test</h3><p>数据量为 223479条</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## mysql 用时:11.081s</span></span><br><span class=\"line\">SELECT * FROM company WHERE company_name LIKE <span class=\"string\">\"%建%\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## es &lt; 1s</span></span><br><span class=\"line\">localhost:9200/company-100/_doc/_search?q=company_name:建</span><br></pre></td></tr></table></figure>\n<h3 id=\"Extra\"><a href=\"#Extra\" class=\"headerlink\" title=\"Extra\"></a>Extra</h3><ul>\n<li>本次测试223479条mysql数据为60.58MB，导入ES后,查看<code>http://localhost:9200/_cat/indices?v</code>，数据为106.6MB</li>\n</ul>\n<h3 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h3><ul>\n<li><a href=\"http://solr-vs-elasticsearch.com/\" target=\"_blank\" rel=\"noopener\">http://solr-vs-elasticsearch.com/</a></li>\n<li><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html\" target=\"_blank\" rel=\"noopener\">elasticsearch document</a></li>\n<li><a href=\"https://blog.csdn.net/qq924862077/article/details/80382634\" target=\"_blank\" rel=\"noopener\">为什么Elasticsearch/Lucene检索可以比MySQL快</a></li>\n<li><a href=\"https://index.baidu.com/v2/main/index.html#/trend/elasticsearch?words=elasticsearch,solr\" target=\"_blank\" rel=\"noopener\">百度指数对比</a></li>\n</ul>\n","prev":{"title":"elasticsearch sketch","slug":"elasticsearch-with-docker-compose"},"next":{"title":"Mysql transaction","slug":"mysql-transaction"},"link":"https://spaco.github.io/post/test/test/","toc":[{"title":"Elasticsearch","id":"Elasticsearch","index":"1","children":[{"title":"Why ES","id":"Why-ES","index":"1.1"},{"title":"Development Environment","id":"Development-Environment","index":"1.2"},{"title":"Point Conception","id":"Point-Conception","index":"1.3"},{"title":"Install","id":"Install","index":"1.4"},{"title":"Build &amp; Start","id":"Build-amp-Start","index":"1.5"},{"title":"Check","id":"Check","index":"1.6"},{"title":"API","id":"API","index":"1.7","children":[{"title":"Index","id":"Index","index":"1.7.1"},{"title":"Document","id":"Document","index":"1.7.2"}]},{"title":"Test","id":"Test","index":"1.8"},{"title":"Extra","id":"Extra","index":"1.9"},{"title":"References","id":"References","index":"1.10"}]}]}