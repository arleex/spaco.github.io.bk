{"title":"Implementing the openssl_encrypt method of PHP using Java","date":"2019-09-11T00:00:00.000Z","link":"post/Implementing-the-openssl_encrypt-method-of-PHP-using-Java","tags":["notes"],"categories":["program"],"updated":"2019-09-11T00:00:00.000Z","content":"<p>使用 Java 实现 PHP openssl_encrypt加密方法</p>\n<h2 id=\"PHP-Implement\">PHP Implement<a href=\"post/Implementing-the-openssl_encrypt-method-of-PHP-using-Java#PHP-Implement\"></a></h2><figure class=\"highlight php\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">encrypt</span><span class=\"params\">($input, $key)</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123;</span><br><span class=\"line\">       $data = openssl_encrypt($input, <span class=\"string\">'AES-128-ECB'</span>, $key, OPENSSL_RAW_DATA);</span><br><span class=\"line\">       $data = base64_encode($data);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> $data;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decrypt</span><span class=\"params\">($input, $key)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t$decrypted = openssl_decrypt(base64_decode($input), <span class=\"string\">'AES-128-ECB'</span>, $key, OPENSSL_RAW_DATA);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> $decrypted;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"Java-Implement\">Java Implement<a href=\"post/Implementing-the-openssl_encrypt-method-of-PHP-using-Java#Java-Implement\"></a></h2><figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">encrypt</span><span class=\"params\">(String data, String password)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">byte</span>[] key = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">16</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i &lt; password.getBytes().length) &#123;</span><br><span class=\"line\">            key[i] = password.getBytes()[i];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            key[i] = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    Cipher cipher = Cipher.getInstance(<span class=\"string\">\"AES/ECB/PKCS5Padding\"</span>);</span><br><span class=\"line\">    cipher.init(Cipher.ENCRYPT_MODE, <span class=\"keyword\">new</span> SecretKeySpec(key, <span class=\"string\">\"AES\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Base64.getEncoder().encodeToString(cipher.doFinal(data.getBytes()));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>注意： 如果采用的是 <code>AES-128-CBC</code>，那么 Java Implement 则要改成</p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">encrypt</span><span class=\"params\">(String data, String password, String iv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] key = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">16</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i &lt; password.getBytes().length) &#123;</span><br><span class=\"line\">                key[i] = password.getBytes()[i];</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                key[i] = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Cipher cipher = Cipher.getInstance(<span class=\"string\">\"AES/CBC/PKCS5Padding\"</span>);</span><br><span class=\"line\"><span class=\"comment\">//        byte[] ivs= &#123;0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0&#125;;</span></span><br><span class=\"line\">        cipher.init(Cipher.ENCRYPT_MODE, <span class=\"keyword\">new</span> SecretKeySpec(key, <span class=\"string\">\"AES\"</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> IvParameterSpec(iv.getBytes()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span>  Base64.getEncoder().encodeToString(cipher.doFinal(data.getBytes()));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></div></figure>","prev":{"title":"Spring Cloud Stream","link":"post/spring-cloud-stream"},"next":{"title":"Spring Cloud Netflix Eureka","link":"post/spring-cloud-Netflix-eureka"},"plink":"https://spaco.github.io/post/Implementing-the-openssl_encrypt-method-of-PHP-using-Java/","toc":[{"title":"PHP Implement","id":"PHP-Implement","index":"1"},{"title":"Java Implement","id":"Java-Implement","index":"2"}]}